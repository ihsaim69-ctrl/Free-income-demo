<!--
Demo: "Free Income Demo" (Offline single-file)
Instructions:
1. Save this file as index.html
2. Open with Chrome (or any browser) to run.
3. Admin account: username: admin  password: admin123
4. To test referral: sign up user A, copy referral code from profile, sign up user B using that ref code.
5. This is a front-end demo using localStorage only ‚Äî no real payments.
-->
<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Free Income ‚Äî Demo (Offline)</title>
<style>
  :root{
    --bg:#eaf4ff; --primary:#007bff; --dark:#003366; --ok:#28a745;
  }
  body{font-family: "Noto Sans Bengali",sans-serif; margin:0; background:var(--bg); color:var(--dark);}
  header{background:linear-gradient(90deg,#f8fbff,#e6f2ff); padding:12px 18px; display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 6px rgba(0,0,0,0.06)}
  header h1{margin:0;font-size:18px;color:var(--primary)}
  .container{max-width:960px;margin:18px auto;padding:12px}
  .card{background:white;border-radius:10px;padding:14px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,0.06)}
  .flex{display:flex;gap:12px;align-items:center}
  .btn{background:var(--primary);color:white;padding:10px 14px;border:none;border-radius:8px;cursor:pointer}
  .btn.secondary{background:#0056b3}
  .btn.ghost{background:transparent;color:var(--primary);border:1px solid #bcd7ff}
  input,select{padding:8px;border-radius:8px;border:1px solid #ccdbea;width:100%}
  .cols{display:grid;grid-template-columns:1fr 320px;gap:12px}
  .task{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;border:1px dashed #e0efff;margin-bottom:8px}
  .small{font-size:13px;color:#4b5563}
  .center{text-align:center}
  .muted{color:#6b7280}
  .gold{color:#b88700}
  .green{color:var(--ok)}
  footer{font-size:13px;color:#6b7280;text-align:center;margin-top:14px}
  .hidden{display:none}
  .profile-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #eef6ff;text-align:left}
  .danger{background:#ffeef0;color:#b91c1c;padding:6px;border-radius:6px}
  @media(max-width:900px){.cols{grid-template-columns:1fr;}}
</style>
</head>
<body>

<header>
  <h1>üí∞ Free Income Demo ‚Äî (‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶Æ‡¶§ ‡¶¶‡ßá‡¶ñ‡ßã)</h1>
  <div>
    <span id="topUser" class="small muted">Not logged in</span>
    <button class="btn ghost" onclick="openLogin()">‡¶≤‡¶ó‡¶á‡¶® / ‡¶∏‡¶æ‡¶á‡¶®-‡¶Ü‡¶™</button>
  </div>
</header>

<div class="container">
  <!-- Login area (modal-like) -->
  <div id="loginCard" class="card hidden">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">‡¶≤‡¶ó‡¶á‡¶® / ‡¶∏‡¶æ‡¶á‡¶®-‡¶Ü‡¶™</h3>
      <div><button class="btn ghost" onclick="closeLogin()">‡¶¨‡¶®‡ßç‡¶ß</button></div>
    </div>
    <div style="margin-top:12px">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div>
          <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ (‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø‡¶§‡ßá)</label>
          <input id="signup_username" placeholder="username"/>
        </div>
        <div>
          <label>‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label>
          <input id="signup_password" type="password" placeholder="password"/>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
        <div>
          <label>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡ßã‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
          <input id="signup_ref" placeholder="ref_xxx"/>
        </div>
        <div class="center" style="align-self:end">
          <button class="btn" onclick="signup()">‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶æ‡¶á‡¶®-‡¶Ü‡¶™</button>
        </div>
      </div>

      <hr style="margin:12px 0"/>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div>
          <label>‡¶≤‡¶ó‡¶á‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</label>
          <input id="login_username" placeholder="username"/>
        </div>
        <div>
          <label>‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label>
          <input id="login_password" type="password" placeholder="password"/>
        </div>
      </div>
      <div style="margin-top:8px" class="center">
        <button class="btn" onclick="login()">‡¶≤‡¶ó‡¶á‡¶®</button>
        <button class="btn ghost" onclick="guestLogin()">‡¶ó‡ßá‡¶∏‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶¶‡ßá‡¶ñ‡ßã</button>
      </div>
      <p class="small muted" style="margin-top:8px">Admin: username <strong>admin</strong>, password <strong>admin123</strong></p>
    </div>
  </div>

  <!-- Main content -->
  <div class="cols">
    <div>
      <!-- Dashboard card -->
      <div class="card" id="dashboard" >
        <div class="profile-row">
          <div>
            <div class="small muted">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‚Äî <strong id="displayName">Guest</strong></div>
            <div style="margin-top:6px">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <span id="balance" style="font-size:18px;color:var(--primary)">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</div>
          </div>
          <div style="text-align:right">
            <button class="btn" onclick="openTasks()">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="btn ghost" onclick="openProfile()">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</button>
          </div>
        </div>

        <hr style="margin:12px 0"/>

        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <div style="flex:1 1 220px;">
            <div class="small muted">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</div>
            <div id="todayTasks" style="margin-top:8px"></div>
          </div>
          <div style="flex:1 1 220px;">
            <div class="small muted">‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</div>
            <div id="refBox" style="margin-top:8px">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡ßã</div>
          </div>
          <div style="flex:1 1 220px;">
            <div class="small muted">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶æ‡¶≤</div>
            <div style="margin-top:8px">
              <button class="btn secondary" onclick="openWithdraw()">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</button>
              <button class="btn ghost" onclick="openAddMoney()">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ü‡¶æ‡¶ï‡¶æ (‡¶°‡ßá‡¶Æ‡ßã)</button>
            </div>
          </div>
        </div>

      </div>

      <!-- Tasks modal -->
      <div id="tasksCard" class="card hidden">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 style="margin:0">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</h3>
          <div><button class="btn ghost" onclick="closeTasks()">‡¶¨‡¶®‡ßç‡¶ß</button></div>
        </div>
        <div style="margin-top:10px">
          <div class="small muted">‡¶®‡¶ø‡¶ö‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‚Äî ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶è ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï ‡¶π‡¶¨‡ßá‡•§</div>
          <div id="tasksList" style="margin-top:12px"></div>
        </div>
      </div>

      <!-- Profile -->
      <div id="profileCard" class="card hidden">
        <div style="display:flex;justify-content:space-between">
          <h3 style="margin:0">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>
          <div><button class="btn ghost" onclick="closeProfile()">‡¶¨‡¶®‡ßç‡¶ß</button></div>
        </div>
        <div style="margin-top:10px">
          <label>‡¶®‡¶æ‡¶Æ</label>
          <input id="profile_name" />
          <label style="margin-top:8px">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡¶°‡ßá‡¶Æ‡ßã)</label>
          <input id="profile_bkash" placeholder="01XXXXXXXXX"/>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button class="btn" onclick="saveProfile()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßã</button>
            <button class="btn ghost" onclick="copyReferral()">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø</button>
          </div>
          <div style="margin-top:12px" class="small muted">
            ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï: <span id="referralLink">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá</span>
          </div>
          <div style="margin-top:12px">
            <button class="btn danger" onclick="logout()">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
          </div>
        </div>
      </div>

      <!-- Add money (demo) -->
      <div id="addMoneyCard" class="card hidden">
        <div style="display:flex;justify-content:space-between">
          <h3 style="margin:0">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ü‡¶æ‡¶ï‡¶æ (‡¶°‡ßá‡¶Æ‡ßã)</h3>
          <div><button class="btn ghost" onclick="closeAddMoney()">‡¶¨‡¶®‡ßç‡¶ß</button></div>
        </div>
        <div style="margin-top:10px">
          <label>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶ü‡ßá‡¶Æ‡ßç‡¶™)</label>
          <input id="add_amount" placeholder="50" />
          <div style="margin-top:8px">
            <button class="btn" onclick="doAddMoney()">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° (‡¶°‡ßá‡¶Æ‡ßã)</button>
          </div>
        </div>
      </div>

      <!-- Withdraw -->
      <div id="withdrawCard" class="card hidden">
        <div style="display:flex;justify-content:space-between">
          <h3 style="margin:0">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</h3>
          <div><button class="btn ghost" onclick="closeWithdraw()">‡¶¨‡¶®‡ßç‡¶ß</button></div>
        </div>
        <div style="margin-top:10px">
          <label>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶æ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
          <input id="withdraw_amount" placeholder="100" />
          <label style="margin-top:8px">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
          <input id="withdraw_bkash" placeholder="01XXXXXXXXX" />
          <div style="margin-top:8px;display:flex;gap:8px">
            <button class="btn" onclick="requestWithdraw()">‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</button>
          </div>
          <div id="withdrawMsg" class="small muted" style="margin-top:8px"></div>
        </div>
      </div>

    </div>

    <!-- Right column (Admin + Stats) -->
    <div>
      <div class="card">
        <h3 style="margin:0">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏</h3>
        <div style="margin-top:10px" id="statBox">
          <div class="small muted">‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞: <strong id="statUsers">0</strong></div>
          <div class="small muted">‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ (‡¶Ü‡¶ú): <strong id="statActive">0</strong></div>
          <div class="small muted">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡ßç‡¶Ø): <strong id="statTotal">0</strong> ‡¶ü‡¶æ‡¶ï‡¶æ</div>
          <div style="margin-top:8px">
            <button class="btn ghost" onclick="openAdmin()">Admin ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</button>
          </div>
        </div>
      </div>

      <div id="adminPanel" class="card hidden">
        <h3 style="margin:0">Admin Panel</h3>
        <div style="margin-top:10px">
          <div class="small muted">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</div>
          <div style="max-height:220px;overflow:auto;margin-top:8px">
            <table id="usersTable">
              <thead><tr><th>Username</th><th>Name</th><th>Balance</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div style="margin-top:10px">
            <div class="small muted">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</div>
            <div id="withdrawList" style="margin-top:8px"></div>
          </div>
          <div style="margin-top:8px">
            <button class="btn ghost" onclick="closeAdmin()">‡¶¨‡¶®‡ßç‡¶ß</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <footer class="muted">Demo ‚Äî ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü/‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶Ü‡¶Æ‡¶ø Firebase + bKash integration ‡¶ó‡¶æ‡¶á‡¶° ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡•§</footer>
</div>

<script>
/* ---------------------
  Data model (localStorage)
  - users: object keyed by username
    {
      password,
      name,
      bkash,
      balance,
      completedTasks: {taskId:true},
      lastCheckIn: "YYYY-MM-DD",
      referral: "ref_username",
      referrals: [],
      withdrawals: [{id,amount,bkash,status}]
    }
  - currentUser: username|null
  ---------------------- */

const TASKS = [
  {id:'tiktok', title:'TikTok ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®', reward:10, desc:'TikTok ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® 10 ‡¶ü‡¶æ‡¶ï‡¶æ (‡¶°‡ßá‡¶Æ‡ßã)'},
  {id:'imo', title:'IMO ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®', reward:8, desc:'IMO ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® 8 ‡¶ü‡¶æ‡¶ï‡¶æ (‡¶°‡ßá‡¶Æ‡ßã)'},
  {id:'messenger', title:'Messenger ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®', reward:7, desc:'Messenger ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® 7 ‡¶ü‡¶æ‡¶ï‡¶æ (‡¶°‡ßá‡¶Æ‡ßã)'},
  {id:'checkin', title:'‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶ö‡ßá‡¶ï-‡¶á‡¶®', reward:2, desc:'‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï-‡¶á‡¶® ‡¶ï‡¶∞‡¶≤‡ßá 2 ‡¶ü‡¶æ‡¶ï‡¶æ (‡¶°‡ßá‡¶Æ‡ßã)'},
];

function loadUsers(){ return JSON.parse(localStorage.getItem('demo_users')||'{}'); }
function saveUsers(u){ localStorage.setItem('demo_users', JSON.stringify(u)); }
function getCurrent(){ return localStorage.getItem('demo_current') || null; }
function setCurrent(x){ if(x) localStorage.setItem('demo_current', x); else localStorage.removeItem('demo_current'); updateUI(); }

function openLogin(){ document.getElementById('loginCard').classList.remove('hidden'); }
function closeLogin(){ document.getElementById('loginCard').classList.add('hidden'); }
function openTasks(){ if(!getCurrent()){ alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); openLogin(); return; } renderTasks(); document.getElementById('tasksCard').classList.remove('hidden'); }
function closeTasks(){ document.getElementById('tasksCard').classList.add('hidden'); }
function openProfile(){ if(!getCurrent()){ alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); openLogin(); return; } renderProfile(); document.getElementById('profileCard').classList.remove('hidden'); }
function closeProfile(){ document.getElementById('profileCard').classList.add('hidden'); }
function openAddMoney(){ if(!getCurrent()){ alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); openLogin(); return; } document.getElementById('addMoneyCard').classList.remove('hidden'); }
function closeAddMoney(){ document.getElementById('addMoneyCard').classList.add('hidden'); }
function openWithdraw(){ if(!getCurrent()){ alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); openLogin(); return; } document.getElementById('withdrawCard').classList.remove('hidden'); }
function closeWithdraw(){ document.getElementById('withdrawCard').classList.add('hidden'); }

function signup(){
  const username = (document.getElementById('signup_username').value||'').trim();
  const password = document.getElementById('signup_password').value||'';
  const ref = (document.getElementById('signup_ref').value||'').trim();
  if(!username || !password){ alert('username ‡¶è‡¶¨‡¶Ç password ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá'); return; }
  const users = loadUsers();
  if(users[username]){ alert('‡¶è‡¶á username ‡¶á‡¶§‡ßã‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ü‡¶õ‡ßá ‚Äî ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã'); return; }
  users[username] = {
    password, name:username, bkash:'', balance:0, completedTasks:{}, lastCheckIn:null,
    referral:`ref_${username}`, referrals:[], withdrawals:[]
  };
  // referral bonus (demo)
  if(ref){
    // find referrer by referral code
    for(const u in users){
      if(users[u].referral === ref){
        users[u].balance += 5; // refer bonus
        users[u].referrals.push(username);
        alert('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶∞‡¶ï‡ßá ‡¶°‡ßá‡¶Æ‡ßã ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (‡ß´ ‡¶ü‡¶æ‡¶ï‡¶æ)');
        break;
      }
    }
  }
  saveUsers(users);
  setCurrent(username);
  closeLogin();
  updateUI();
  alert('‡¶∏‡¶æ‡¶á‡¶®-‡¶Ü‡¶™ ‡¶∏‡¶´‡¶≤ ‚Äî ‡¶Ü‡¶™‡¶®‡¶ø logged in ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®');
}

function login(){
  const username = (document.getElementById('login_username').value||'').trim();
  const password = document.getElementById('login_password').value||'';
  const users = loadUsers();
  if(!users[username] || users[username].password !== password){ alert('‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‚Äî username/password ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßã'); return; }
  setCurrent(username);
  closeLogin();
  updateUI();
}

function guestLogin(){
  // create or reuse guest user
  const username = 'guest_'+Math.floor(Math.random()*10000);
  const users = loadUsers();
  users[username] = {password:'', name:'Guest', bkash:'', balance:0, completedTasks:{}, lastCheckIn:null, referral:`ref_${username}`, referrals:[], withdrawals:[]};
  saveUsers(users);
  setCurrent(username);
  closeLogin();
  updateUI();
}

function logout(){
  setCurrent(null);
  alert('Logged out');
}

function renderTasks(){
  const cur = getCurrent();
  const users = loadUsers();
  const user = users[cur];
  const list = document.getElementById('tasksList');
  list.innerHTML = '';
  TASKS.forEach(t=>{
    const completed = user && user.completedTasks && user.completedTasks[t.id];
    const div = document.createElement('div');
    div.className='task';
    div.innerHTML = `<div>
        <div style="font-weight:600">${t.title}</div>
        <div class="small muted">${t.desc}</div>
      </div>
      <div style="text-align:right">
        <div class="small muted">‡¶á‡¶®: <strong>${t.reward} ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
        <div style="margin-top:8px">
          <button class="btn" ${completed ? 'disabled' : ''} onclick="performTask('${t.id}')">${completed ? '‚úì ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®' : '‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°/‡¶ï‡¶∞‡ßã'}</button>
        </div>
      </div>`;
    list.appendChild(div);
  });
}

function performTask(taskId){
  const cur = getCurrent();
  if(!cur){ alert('‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßã'); return; }
  const users = loadUsers(); const user = users[cur];
  // special: checkin
  if(taskId==='checkin'){
    const today = new Date().toISOString().slice(0,10);
    if(user.lastCheckIn===today){ alert('‡¶Ü‡¶ú ‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ö‡ßá‡¶ï-‡¶á‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®'); return; }
    user.balance += TASKS.find(x=>x.id==='checkin').reward;
    user.lastCheckIn = today;
    saveUsers(users);
    updateUI();
    alert('‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶ö‡ßá‡¶ï-‡¶á‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‚Äî ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    renderTasks();
    return;
  }
  // For other tasks: simulate "download then verify"
  const t = TASKS.find(x=>x.id===taskId);
  if(!t) return;
  // Show confirm popup to simulate external download
  if(confirm(`${t.title} ‡¶Ü‡¶™‡¶®‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§? (‡¶°‡ßá‡¶Æ‡ßã) - ${t.reward} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶¨‡ßá`)){
    // Mark completed and add balance only if not previously completed
    if(!user.completedTasks) user.completedTasks = {};
    if(user.completedTasks[taskId]){ alert('‡¶è‡¶á ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ü‡¶ó‡ßá ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá'); return; }
    user.completedTasks[taskId] = true;
    user.balance += t.reward;
    saveUsers(users);
    updateUI();
    renderTasks();
    alert(t.reward + ' ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (‡¶°‡ßá‡¶Æ‡ßã)');
  }
}

function renderProfile(){
  const cur = getCurrent();
  const users = loadUsers();
  const user = users[cur];
  document.getElementById('profile_name').value = user.name || '';
  document.getElementById('profile_bkash').value = user.bkash || '';
  document.getElementById('referralLink').textContent = location.origin + '/?ref=' + user.referral;
}

function saveProfile(){
  const cur = getCurrent();
  if(!cur){ alert('‡¶≤‡¶ó‡¶ø‡¶® ‡¶ï‡¶∞‡ßã'); return; }
  const users = loadUsers();
  users[cur].name = document.getElementById('profile_name').value || cur;
  users[cur].bkash = document.getElementById('profile_bkash').value || '';
  saveUsers(users);
  updateUI();
  alert('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
}

function copyReferral(){
  const cur = getCurrent();
  if(!cur){ alert('‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßã'); return; }
  const users = loadUsers();
  const link = location.origin + '/?ref=' + users[cur].referral;
  navigator.clipboard?.writeText(link).then(()=>alert('‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá'), ()=>alert('‡¶ï‡¶™‡¶ø ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‚Äî ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßã: ' + link));
}

function doAddMoney(){
  const amt = parseInt(document.getElementById('add_amount').value||'0');
  if(!amt || amt<=0){ alert('‡¶¨‡ßà‡¶ß ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¶‡¶æ‡¶ì'); return; }
  const cur = getCurrent();
  if(!cur){ alert('‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßã'); return; }
  const users = loadUsers(); users[cur].balance += amt; saveUsers(users);
  closeAddMoney(); updateUI(); alert('‡¶°‡ßá‡¶Æ‡ßã: ' + amt + ' ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
}

function requestWithdraw(){
  const amt = parseInt(document.getElementById('withdraw_amount').value||'0');
  const bk = document.getElementById('withdraw_bkash').value||'';
  const cur = getCurrent();
  if(!cur){ alert('‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßã'); return; }
  const users = loadUsers(); const user = users[cur];
  if(amt<=0 || amt>user.balance){ alert('‡¶¨‡ßà‡¶ß ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ü‡¶õ‡ßá'); return; }
  const id = 'wd_'+Date.now();
  user.withdrawals.push({id, amount:amt, bkash:bk, status:'pending'});
  user.balance -= amt; // temporarily deduct
  saveUsers(users);
  closeWithdraw(); updateUI(); alert('‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (‡¶°‡ßá‡¶Æ‡ßã)');
}

/* Admin */
function openAdmin(){
  const cur = getCurrent();
  if(cur !== 'admin'){ const pw = prompt('Admin password ‡¶ö‡¶æ‡¶á ‚Äî ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡¶§‡ßá:'); if(pw !== 'admin123'){ alert('‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤'); return; } setCurrent('admin'); }
  renderAdmin();
  document.getElementById('adminPanel').classList.remove('hidden');
}
function closeAdmin(){ document.getElementById('adminPanel').classList.add('hidden'); if(getCurrent()==='admin') setCurrent(null); }
function renderAdmin(){
  const users = loadUsers();
  const tbody = document.querySelector('#usersTable tbody');
  tbody.innerHTML = '';
  let total = 0, cnt=0;
  for(const u in users){
    cnt++;
    total += Number(users[u].balance||0);
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u}</td><td>${users[u].name||''}</td><td>${users[u].balance||0}</td>
      <td>
        <button class="btn ghost" onclick="adminViewUser('${u}')">View</button>
        <button class="btn" onclick="adminResetUser('${u}')">Reset</button>
      </td>`;
    tbody.appendChild(tr);
  }
  document.getElementById('statUsers').textContent = cnt;
  document.getElementById('statTotal').textContent = total;
  // withdrawals
  const wbox = document.getElementById('withdrawList'); wbox.innerHTML='';
  for(const u in users){
    users[u].withdrawals && users[u].withdrawals.forEach(w=>{
      const el = document.createElement('div');
      el.style.border='1px solid #eef6ff'; el.style.padding='8px'; el.style.marginBottom='6px';
      el.innerHTML = `<div><strong>${u}</strong> - ${w.amount} ‡¶ü‡¶æ‡¶ï‡¶æ - ${w.status}</div>
        <div style="margin-top:6px">
          ${w.status==='pending' ? `<button class="btn" onclick="adminApprove('${u}','${w.id}')">Approve</button> <button class="btn ghost" onclick="adminReject('${u}','${w.id}')">Reject</button>` : ''}
        </div>`;
      wbox.appendChild(el);
    });
  }
}
function adminViewUser(u){
  const users = loadUsers();
  const user = users[u];
  alert(`User: ${u}\nName: ${user.name}\nBalance: ${user.balance}\nReferrals: ${user.referrals.length}\nCompleted tasks: ${Object.keys(user.completedTasks||{}).length}`);
}
function adminResetUser(u){
  if(!confirm('Reset user data?')) return;
  const users = loadUsers();
  users[u].balance = 0; users[u].completedTasks = {}; users[u].withdrawals = []; users[u].lastCheckIn = null;
  saveUsers(users); renderAdmin(); updateUI(); alert('Reset ‡¶π‡ßü‡ßá‡¶õ‡ßá (‡¶°‡ßá‡¶Æ‡ßã)');
}
function adminApprove(u,id){
  const users = loadUsers();
  const user = users[u];
  const w = user.withdrawals.find(x=>x.id===id);
  if(!w) return;
  w.status='approved';
  saveUsers(users);
  renderAdmin(); updateUI();
  alert('Approve ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã (‡¶°‡ßá‡¶Æ‡ßã ‚Äî ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø)');
}
function adminReject(u,id){
  const users = loadUsers();
  const user = users[u];
  const w = user.withdrawals.find(x=>x.id===id);
  if(!w) return;
  w.status='rejected';
  // refund amount
  user.balance += w.amount;
  saveUsers(users);
  renderAdmin(); updateUI();
  alert('Reject ‚Äî ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶á‡¶â‡¶ú
